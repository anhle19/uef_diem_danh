@*
    For more information on enabling MVC for empty projects, visit https://go.microsoft.com/fwlink/?LinkID=397860
*@
@using System.Text.Json
@model List<uef_diem_danh.DTOs.StudyClassStudentListManagementResponse>
@{

	Layout = "~/Views/Layout/Main.cshtml";
	ViewData["Title"] = "Quản lý học viên của lớp học";

	// var studentsList = JsonSerializer.Serialize(Model);
}


<!-- PRINT STUDENT CARD STYLE -->
<style>

	/* Single Student Card */
	.sheet {
		height: 100mm !important;
		width: 70mm !important;
	}
	.student-card {
		width: 270px; /* Chiều rộng cố định */
		height: 375px; /* Chiều cao cố định */
		border-radius: 15px; /* Bo tròn góc */
		box-shadow: 0 4px 8px rgba(0,0,0,0.1); /* Tạo bóng đổ */
		overflow: hidden; /* Ẩn các phần nội dung tràn ra ngoài */
		display: flex;
		flex-direction: column;
		justify-content: space-between;
	}

	.card-img-top {
		width: 120px; /* Kích thước ảnh */
		height: 120px;
		object-fit: cover; /* Đảm bảo ảnh không bị méo */
		border-radius: 10px; /* Bo tròn góc ảnh để có hình vuông bo góc */
		border: 4px solid #ffffff; /* Viền trắng cho ảnh */
		margin-top: 14px;
	}

	.card-body h5 {
		font-size: 1.3rem; /* Tăng kích thước font tên */
		font-weight: 700;
	}

	.card-body p {
		font-size: 0.9rem; /* Giảm kích thước font các thông tin khác */
		margin-bottom: 5px;
	}

	.card-footer {
		background-color: #0d6efd; /* Màu nền cho footer */
		color: #ffffff; /* Màu chữ trắng */
		font-size: 0.8rem;
		text-align: center;
	}

	.barcode-section {
		padding: 5px 0;
		background-color: #ffffff;
		border-top: 1px solid #e9ecef;
	}


	/* Multiple Student Cards */
	:root {
		/* Quy đổi 204x321 px ~ 54x85 mm (96dpi) để in ra đúng kích thước */
		--card-w-mm: 54mm;
		--card-h-mm: 85mm;
		--gap-mm: 3mm;
		--pad-x-mm: 7.5mm; /* 2 bên: 7.5 + 7.5 = 15mm, vừa khít 5 cột */
		--pad-y-mm: 12.5mm; /* trên + dưới, canh giữa dọc trang */
	}
	/* Tờ A4 nằm ngang: 297 x 210 mm */
	.multiple-student-cards-sheet {
		width: 297mm;
		height: 210mm;
		margin: 0 auto;
		background: #fff;
		box-sizing: border-box;
		display: grid;
		grid-template-columns: repeat(5, var(--card-w-mm));
		grid-auto-rows: var(--card-h-mm);
		gap: var(--gap-mm);
		padding: var(--pad-y-mm) var(--pad-x-mm);
		overflow: hidden;
		/* chống cắt khi in */
		page-break-inside: avoid;
		break-inside: avoid;
	}

	/* Card theo đúng kích thước yêu cầu */
	.multiple-student-card {
		width: var(--card-w-mm);
		height: var(--card-h-mm);
		border-radius: 15px;
		box-shadow: 0 4px 8px rgba(0,0,0,.10);
		overflow: hidden;
		display: flex;
		flex-direction: column;
		justify-content: space-between;
		border: 2px solid #e9ecef;
		/* chống cắt khi in */
		page-break-inside: avoid;
		break-inside: avoid;
	}

	.multiple-card-top {
		padding-top: 14px;
		text-align: center;
	}

	.multiple-card-img-top {
		width: 120px;
		height: 120px;
		object-fit: cover;
		border-radius: 10px;
		border: 4px solid #ffffff;
		display: block;
		margin: 0 auto 6px;
	}

	.multiple-card-body {
		padding: 6px 10px 8px;
	}

	.multiple-card-body h5 {
		font-size: 1.05rem; /* vừa mắt trên card 54x85mm */
		font-weight: 700;
		margin-bottom: 4px;
		color: #0d6efd;
	}

	.multiple-card-body p {
		font-size: .85rem;
		margin: 0 0 4px 0;
		color: #6c757d;
	}

	.multiple-barcode-section {
		padding: 5px 0 7px;
		background: #ffffff;
		border-top: 1px solid #e9ecef;
		text-align: center;
	}

</style>

<div>
	@if (TempData["StudentInStudyClassSuccessMessage"] != null)
	{
		<div class="bg-success p-2 text-white">
			@TempData["StudentInStudyClassSuccessMessage"]
		</div>
	}
	@if (TempData["StudentInStudyClassErrorMessage"] != null)
	{
		<div class="bg-danger">
			@TempData["StudentInStudyClassErrorMessage"]
		</div>
	}
	<div class="d-flex justify-content-between align-items-start mb-3">
		<div style="width: 30rem">
			<h2 class="table-title">Quản lý học viên của lớp học</h2>
			<div class="d-flex search-row">
				<form id="searchOrderStudyClassForm"
					  style="width: 100%"
					  onsubmit="return preventSearchStudentManagementInStudyClassSubmit()">

					<input id="studentManagementInStudyClassSearchInput"
						   class="form-control form-control-sm"
						   name="StudyClassName"
						   placeholder="Tìm theo tên họ tên, email, sđt..."
						   style="width: 70%; display: inline"/>
					<button type="button"
							class="btn-next-secondary btn-sm"
							id="searchStudentManagementInStudyClassBtn"
							onclick="searchStudentManagementInStudyClass()">
						Tìm
					</button>
				</form>
			</div>
		</div>
		<div>
			<a 
				href="/in-danh-sach-the-hoc-vien/@ViewBag.StudyClassId" 
				target="_blank"
				class="btn-next-secondary btn -sm btn-add">
				Xuất tất cả thẻ học viên
			</a>
			<button type="button"
					class="btn-next-secondary btn -sm btn-add"
					data-bs-toggle="modal"
					data-bs-target="#popupThemHocVienCuaLopHocTuFileExcel">
				Thêm học viên từ file Excel
			</button>
			<button type="button"
					class="btn-next-secondary btn -sm btn-add"
					data-bs-toggle="modal"
					data-bs-target="#popupThemHocVien"
					data-id="@ViewBag.StudyClassId"
					onclick="initAddStudentFields(@ViewBag.StudyClassId)">
				Thêm học viên
			</button>
		</div>
	</div>

	<!-- Study Class Id -->
	<input type="hidden" id="studyClassId" name="studyClassId" value="@ViewBag.StudyClassId" />

	<div class="table-wrapper">
		<div id="searchResultLabel" style="display: none">Kết quả tìm kiếm: </div>
		<table id="studentManagementInStudyClassTable" class="fl-table">
			<thead>
				<tr>
					<th class="text-center">STT</th>
					<th class="text-center">Ảnh</th>
					<th class="text-center">Họ và tên</th>
					<th class="text-center">Số điện thoại</th>
					<th class="text-center">Địa chỉ</th>
					<th class="text-center">Ngày sinh</th>
					<th></th>
				</tr>
			</thead>
			<tbody id="classesTableBody">
				@{
					int stt = 1;
				}
				@foreach (var student in Model)
				{
					<tr>
						<td>@stt</td>
						<td class="align-content-center">
							<img src="@Url.Content("~/student_pictures/" + student.HinhAnh)" width="100" height="100" />
						</td>
						<td>@student.LastName @student.FirstName</td>
						<td>@student.PhoneNumber</td>
						<td>@student.Address</td>
						<td>@student.DateOfBirth.ToString("dd/MM/yyyy")</td>
						<td>
							<a 
								class="btn btn-outline-primary btn-sm btn-delete"
								data-id="@student.Id"
								href="/in-mot-the-hoc-vien/@student.Id" 
								target="_blank">
								Xuất thẻ
							</a>

							<button class="btn btn-outline-danger btn-sm btn-delete ms-2"
									data-id="@student.Id"
									data-bs-toggle="modal"
									data-bs-target="#popupXoaHocVienCuaLopHoc"
									onclick="initDeleteStudentInStudyClassField(@student.Id)">
								Xoá
							</button>
						</td>
					</tr>

					stt++;
				}
			</tbody>
		</table>
	</div>
</div>


<!-- Modal: Thêm học viên vào lớp học -->
@* @await Html.PartialAsync("/Views/Component/AddStudentToStudyClassModal.cshtml", new uef_diem_danh.DTOs.StudyClassAddStudentRequest()) *@

<!-- Modal: Thêm học viên vào lớp học từ file Excel -->
@await Html.PartialAsync("/Views/Component/AddStudentFromExcelToStudyClassModal.cshtml", new uef_diem_danh.DTOs.ImportStudentToStudyClassByExcelRequest())

<!-- Modal: Xóa học viên khỏi lớp học -->
@await Html.PartialAsync("/Views/Component/DeleteStudentFromStudyClassModal.cshtml", new uef_diem_danh.DTOs.StudyClassRemoveStudentRequest())

<!-- Modal: Thêm mới học viên -->
@await Html.PartialAsync("/Views/Component/CreateNewStudentToClass.cshtml", new uef_diem_danh.DTOs.StudentCreateNewToClassRequest())






<script src="~/js/StudentInStudyClass.js"></script>